# World Optimizer Walkthrough

## 概要
VRChatワールド作成における一般的な最適化作業を自動化するEditor拡張ツールです。

## インストール確認
1. プロジェクトの `Assets/WorldOptimizer/Editor/WorldOptimizerWindow.cs` が存在することを確認してください。
2. Unity Editorのメニューバーに `WorldOptimizer` > `Open Optimizer` が表示されていることを確認してください。

## 使い方

### ウィンドウを開く
メニューバーから `WorldOptimizer` > `Open Optimizer` を選択します。

### 設定項目
ウィンドウ内で以下の最適化項目を個別にOn/Offできます。

- **最適化プロファイル**: 全体的な品質設定を選択します。
  - **標準**: テクスチャMax 2048, 圧縮強め / ライトマップ低解像度（軽量化優先）
  - **高品質**: テクスチャMax 4096, 圧縮弱め / ライトマップ高解像度（クオリティ優先）

- **実行時にバックアップを作成**:
  - **On**: 最適化実行前に現在のシーンを自動で複製保存し、アセット設定の変更記録を残します。
  - **復元**: 実行後、赤い「最適化を元に戻す」ボタンでアセット設定を元に戻せます。シーン自体は複製されたバックアップファイル（`_Backup_日付.unity`）を開くことで復元できます。

- **Missing Scriptの削除**: 削除されたスクリプトへの参照を持つコンポーネントを自動削除します。

### ヘルプ（トラブルシューティング）
新しい「ヘルプ (Help)」タブに、VRChat SDK関連の問題を解決するボタンがあります。
- **Blueprint IDをクリア**: 「Attempted to load the data for a world we do not own」等のエラーが出る場合、これを実行してワールドIDの紐付けを解除します。
- **GPU Instancingを有効化**: マテリアル設定でGPU Instancingを有効化します（対応シェーダーのみ）。
- **テクスチャの最適化**: 
  - Max Sizeを2048に制限
  - Streaming Mip Mapsを有効化
  - Crunch Compressionを有効化
- **オーディオの最適化**:
  - `Force To Mono` を有効化
  - ロードタイプと圧縮形式を最適化
- **Staticフラグの設定**: Rigidbodyを持たないコライダー付きオブジェクトをStatic（Batching, Navigation等）に設定します。

### エラーログ（トラブルシューティング）
エラーや不具合が発生した場合、自動的にログファイル (`WorldOptimizer_Error.log`) がプロジェクトフォルダに生成されます。
- **ログの確認方法**: 「ヘルプ (Help)」タブの「エラーログファイルを開く」ボタンを押すと、ログファイルが表示されます。
- これにより、エラー内容を確認し、報告や修正に役立てることができます。

### 詳細設定 (Advanced)
タブを「詳細設定 (Advanced)」に切り替えると以下の機能が利用できます。

- **メッシュ結合 (Mesh Combiner)**:
  - 選択したオブジェクト（親）の下にあるメッシュを、マテリアルごとに結合します。
  - **使い方**: ヒエラルキーで親オブジェクトを選択し、「選択オブジェクトを結合」ボタンを押します。
  - **効果**: Draw Call（描画負荷）を削減します。
  
- **ライティング最適化 (Lighting)**:
  - VRChat向けの軽量なライトマップ設定を適用します。
  - **内容**: Lightmap Resolution を低めに、Bounces を1回に制限など。

- **メッシュ分析 (Analysis)**:
  - シーン内でポリゴン数が多いオブジェクトを検出し、リストアップします。
  - **使い方**: 「シーン内の高ポリゴンメッシュを検索」ボタンを押し、表示されたリストの「Select」ボタンで対象を確認できます。

### 実行
- **実行ボタン**: 各項目の横にある「実行」ボタンを押すと、その最適化のみを個別に適用できます。
- **一括最適化を実行**: 基本設定のチェックが入っているすべての項目を一括実行します。

### テクスチャ設定
- **最大サイズ (Max Size)**: 「テクスチャ圧縮の最適化」にチェックを入れると、適用する最大解像度（512, 1024, 2048, 4096, 8192）を選択できます。
  - プロファイルを変更すると自動的に推奨値に切り替わりますが、手動で変更して「Custom」設定にすることも可能です。

## 検証手順 (Manual Verification)
以下の手順で動作を確認してください。

1. **Missing Scripts**: 空のゲームオブジェクトにスクリプトを貼り、そのスクリプトファイルを削除して "Missing Script" 状態を作ります。「Missing Scriptの削除のみ実行」を実行して消えるか確認してください。
2. **Materials**: 新規マテリアルを作成し、"Enable GPU Instancing" のチェックを外します。ツール実行後にチェックが入るか確認してください。
3. **Advanced**: 複数のCubeを配置した親オブジェクトを作り、「詳細設定」タブの「選択オブジェクトを結合」を実行し、結合されたメッシュが生成されるか確認してください。
3. **Textures**: 大きなテクスチャ(4k等)を用意し、Max Sizeが2048に変更されるか確認してください。
4. **Undo**: 実行直後に `Ctrl+Z` で取り消せる範囲を確認してください（**注意**: Assetの変更は完全にはUndoできない場合があります）。

> [!WARNING]
> 自動最適化を実行する前には、必ずプロジェクトのバックアップを取ってください。
